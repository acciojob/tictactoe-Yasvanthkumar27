<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tic Tac Toe</title>
  <style>
    body{font-family: Arial, sans-serif; background:#fafafa; padding:40px; display:flex; justify-content:center;}
    .container{width:580px; text-align:center;}
    h1{font-family:"Brush Script MT",cursive; font-size:48px; margin-bottom:18px;}
    .row{display:flex; align-items:center; justify-content:center; gap:10px; margin:8px 0;}
    input[type="text"]{width:320px; padding:10px; border:2px solid #777; border-radius:4px; font-size:16px;}
    button{padding:12px 22px; border-radius:8px; border:2px solid #444; background:#fff; cursor:pointer; font-size:16px;}
    .board{width:360px; height:360px; margin:20px auto; display:grid; grid-template-columns:repeat(3,1fr); grid-template-rows:repeat(3,1fr); gap:0;}
    .cell{border:2px solid #444; display:flex; align-items:center; justify-content:center; font-size:48px; background:#f4dede; cursor:pointer; user-select:none;}
    .message{font-size:20px; margin-top:12px; font-weight:600;}
    .hidden{display:none;}
    .winner { background: #ffdede; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Tic Tac Toe</h1>

    <!-- Start screen -->
    <div id="start-screen">
      <div class="row">
        <label for="player1">Player 1</label>
        <input id="player1" type="text" placeholder="enter name" />
      </div>
      <div class="row">
        <label for="player2">Player 2</label>
        <input id="player2" type="text" placeholder="enter name" />
      </div>
      <div class="row">
        <button id="submit">Start Game</button>
      </div>
    </div>

    <!-- Game screen -->
    <div id="game-screen" class="hidden">
      <!-- tests will look for an element with class or id 'message' -->
      <div id="message" class="message"></div>

      <div class="board" id="board">
        <!-- cells will be created by JS with ids "1".."9" -->
      </div>
    </div>
  </div>

  <script>
    // Elements
    var submitBtn = document.getElementById('submit');
    var startScreen = document.getElementById('start-screen');
    var gameScreen = document.getElementById('game-screen');
    var messageEl = document.getElementById('message');
    var boardEl = document.getElementById('board');

    // Game state
    var player1 = '';
    var player2 = '';
    var current = 'X'; // X starts
    var gameActive = true;
    var board = { '1':'', '2':'', '3':'', '4':'', '5':'', '6':'', '7':'', '8':'', '9':'' };

    var winningPatterns = [
      ['1','2','3'], ['4','5','6'], ['7','8','9'],
      ['1','4','7'], ['2','5','8'], ['3','6','9'],
      ['1','5','9'], ['3','5','7']
    ];

    // Start game
    submitBtn.addEventListener('click', function(){
      player1 = (document.getElementById('player1').value || '').trim();
      player2 = (document.getElementById('player2').value || '').trim();

      if (!player1 || !player2) {
        alert('Please enter both player names');
        return;
      }

      startScreen.classList.add('hidden');
      gameScreen.classList.remove('hidden');
      current = 'X';
      gameActive = true;
      resetBoard();
      messageEl.textContent = player1 + ", you're up";
      loadBoard();
    });

    function resetBoard(){
      for (var k in board) if (board.hasOwnProperty(k)) board[k] = '';
    }

    function loadBoard(){
      boardEl.innerHTML = '';
      // create 9 cells with ids "1".."9" (matches tests)
      for (var i = 1; i <= 9; i++){
        var idStr = String(i);
        var cell = document.createElement('div');
        cell.className = 'cell';
        cell.id = idStr;            // id "1" .. "9"
        cell.setAttribute('data-index', idStr);
        cell.textContent = board[idStr];
        cell.addEventListener('click', onCellClick);
        boardEl.appendChild(cell);
      }
    }

    function onCellClick(e){
      if (!gameActive) return;
      var id = e.target.getAttribute('data-index'); // "1".."9"
      if (!id) return;
      if (board[id] !== '') return; // already filled

      board[id] = current;
      e.target.textContent = current;

      if (checkWinner()) {
        // winner detected inside checkWinner -> message updated there
        gameActive = false;
        return;
      }

      // switch player
      current = (current === 'X') ? 'O' : 'X';
      updateTurnMessage();
    }

    function updateTurnMessage(){
      messageEl.textContent = (current === 'X') ? (player1 + ", you're up") : (player2 + ", you're up");
    }

    function checkWinner(){
      for (var p = 0; p < winningPatterns.length; p++){
        var pat = winningPatterns[p];
        var a = board[pat[0]], b = board[pat[1]], c = board[pat[2]];
        if (a && a === b && b === c){
          var winnerName = (a === 'X') ? player1 : player2;
          messageEl.textContent = winnerName + ", congratulations you won!";
          // optional: highlight winning cells
          highlightWinningCells(pat);
          return true;
        }
      }

      // check tie
      var filled = true;
      for (var key in board) { if (board.hasOwnProperty(key) && board[key] === '') { filled = false; break; } }
      if (filled) {
        messageEl.textContent = "It's a tie!";
        gameActive = false;
        return true;
      }

      return false;
    }

    function highlightWinningCells(cells){
      // add small visual, not required by tests
      cells.forEach(function(id){
        var cellEl = document.getElementById(id);
        if (cellEl) cellEl.classList.add('winner');
      });
    }

    // Optional: protect from uncaught errors during tests (Cypress will still detect real errors)
    window.addEventListener('error', function(e){
      // do not rethrow - allow tests to inspect application state
      // but log to console for debugging
      console.error('App caught error:', e && e.error ? e.error : e);
      // NOTE: Cypress will fail the test if the page actually throws an uncaught error.
      // This handler avoids rethrowing here.
    });
  </script>
</body>
</html>
